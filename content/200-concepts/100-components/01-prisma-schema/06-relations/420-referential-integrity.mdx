---
title: 'Relation mode'
metaTitle: 'Relation mode'
metaDescription: 'TODO'
tocDepth: 2
preview: true
---

<TopBlock>

In relational databases, relations between data is usually implemented with foreign keys. Any relation consists out of a target row in a table, and a foreign key field that points to that row. Foreign keys ensure referential integrity (Can this foreign key field hold this value?) and allow setting referential actions that define how changes to these special fields are handled (What happens if the ID of this field is changed?). 
  
In Prisma, relations are defined using the [`@relation`](/reference/api-reference/prisma-schema-reference#relation) attribute, which then under the hood is translated to foreign keys and the SQL to define referential actions (which are defined with the `onUpdate` and `onUpdate` arguments of the attribute). 

<!--
Prisma allows you to define relations between records using the [`@relation`](/reference/api-reference/prisma-schema-reference#relation) attribute. The `onUpdate` and `onDelete` arguments of this attribute can be used to define which referential action take place on updating or deleting the related record.
-->  
  
<!-- TODO Tab that shows SQL -->
```prisma file=schema.prisma highlight=4;normal
model Post {
  id       Int    @id @default(autoincrement())
  title    String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId Int
}

model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}
```

For databases where foreign keys are not supported (like MongoDB or [PlanetScale](/guides/database/using-prisma-with-planetscale#differences-to-consider)) or are not desired, Prisma offers an alternative relation mode where most properties of relations in relational databases are emulated. When using Prisma Client the behavior of queries is identical or similar, but all referential actions and most referential integrity is actually handled by the Prisma engine under the hood.

<Admonition type="warning">
  There are significant performance implications to emulating referential
  integrity in the Prisma client. In cases where the underlying database can
  handle referential integrity with foreign keys, it is usually the preferred
  choice.
</Admonition>

</TopBlock>

## How to set the relation mode in your Prisma schema

To set the relation mode, you need to enable the `referentialIntegrity` preview feature. Add the `referentialIntegrity` feature flag to the `previewFeatures` list in the [`generator`](/reference/api-reference/prisma-schema-reference#generator) block of your Prisma schema file, and add the `relationMode` field to the [`datasource`](/reference/api-reference/prisma-schema-reference#datasource) block:

```prisma file=schema.prisma highlight=4,9;add
datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator js {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}
```

To change the relation mode, update the `relationMode` field in the `datasource` block.

<Admonition type="warning">

The <inlinecode>relationMode</inlinecode> field was renamed in Prisma version 4.5.0,
and was previously named <inlinecode>referentialIntegrity</inlinecode>.

</Admonition>

The available options are:

- `foreignKeys`: this handles relations in the database using foreign keys. This is the default option when using all relational database connectors.
- `prisma`: this emulates relations in the Prisma client. This is the default (and only available) option when using the MongoDB connector. You should also [enable this option](/guides/database/using-prisma-with-planetscale#how-to-enable-emulation-of-referential-integrity) when using the MySQL connector with a PlanetScale database.

<Admonition type="warning">

When using Prisma Migrate, setting the value to <inlinecode>prisma</inlinecode> will remove all previously created foreign keys in the next migration. Setting the value to <inlinecode>foreignKeys</inlinecode> (either directly or by removing the <inlinecode>relationMode</inlinecode> field and using the default option for relational databases) will create foreign keys for all relations in the next migration.

</Admonition>

## What `relationMode = "prisma"` emulates

TODO

In the case where relations are emulated in Prisma Client using the `prisma` option for the `relationMode` field, there is currently a reduced number of supported [referential actions](/concepts/components/prisma-schema/relations/referential-actions) available in the data model:

| Referential action | `onUpdate` | `onDelete` |
| :----------------- | :--------- | :--------- |
| Restrict           | no         | yes        |
| SetNull            | no         | yes        |
| SetDefault         | no         | no         |
| Cascade            | no         | yes        |
| NoAction           | no         | yes        |

Currently Prisma only implements the referential actions. Foreign keys also create constraints, which make it impossible to manipulate data in a way that would violate these constraints: instead of executing the query, the database responds with an error. These constraints will not be created if you emulate relations in Prisma Client, so if you set the referential action to [`NoAction`](/concepts/components/prisma-schema/relations/referential-actions#noaction) there will be no checks to prevent you from breaking the referential integrity.

Another current limitation when emulating relations in the Prisma Client is that any [`raw`](/concepts/components/prisma-client/raw-database-access) database queries will not trigger any of the actions, and they should be handled manually if deleting or updating records using the [`raw`](/concepts/components/prisma-client/raw-database-access) queries.

When using the `db pull` command, existing relations are kept in the data model. This has some caveats:

- If you delete a model that is part of a relation, Prisma will delete the relation.
- If you delete or rename a scalar field used in a relation field, the relation field will still refer to the old version, leading to validation errors. For example, take the following data model:

  ```prisma file=schema.prisma
  model A {
    field Int
    b     B   @relation(fields: [field], references: [id])
  }
  ```

  If you then change `field` to `renamedField`, you will end up with the following data model after then next `db pull`:

  ```prisma file=schema.prisma
  model A {
    renamedField Int
    b            B   @relation(fields: [field], references: [id])
  }
  ```

  In this case, you need to manually fix the relation to point to `renamedField` instead before continuing to use the data model.

## Handle relations in the database with foreign keys

TODO Probably just remove and link to referential actions instead

In the case where relations are handled in the database using the `foreignKeys` option for the `relationMode` field, all referential actions supported by the database are available:

| action      | `onUpdate` | `onDelete` |
| :---------- | :--------- | :--------- |
| Restrict⟒   | yes        | yes        |
| SetNull     | yes        | yes        |
| SetDefault⟑ | yes        | yes        |
| Cascade     | yes        | yes        |
| NoAction    | yes        | yes        |

- ⟒ Not supported on SQL Server
- ⟑ Not supported on MySQL/InnoDB

In this mode the [`raw`](/concepts/components/prisma-client/raw-database-access) database queries will trigger actions accordingly.
